[Unit]
Description=DNS Fallback Proxy
After=network.target network-online.target
Wants=network-online.target

[Service]
Type=simple
Environment=DNS_LISTEN_PORT=5353
Environment=PRIMARY_DNS_PORT=5335
Environment=PRIMARY_DNS=127.0.0.1
Environment=FALLBACK_DNS=1.1.1.1
Environment=DNS_TIMEOUT=2.0
Environment=FALLBACK_TIMEOUT=3.0
# Fixed: Correct path without /dns-fallback subdirectory
ExecStart=/usr/bin/python3 /usr/local/bin/dns_fallback_proxy.py
Restart=on-failure
RestartSec=5
StandardOutput=append:/var/log/dns-fallback.log
StandardError=append:/var/log/dns-fallback.err
# Fixed: Create dedicated user instead of root
User=dns-fallback
Group=dns-fallback
# Security hardening
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/var/log
# Allow binding to port 5353
AmbientCapabilities=CAP_NET_BIND_SERVICE
CapabilityBoundingSet=CAP_NET_BIND_SERVICE

[Install]
WantedBy=multi-user.target
